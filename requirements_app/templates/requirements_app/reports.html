{% extends "requirements_app/base.html" %}

{% block title %}Reports - E-Parliament Bangladesh{% endblock %}

{% block extra_css %}
<style>
    .report-card {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
        transition: transform 0.3s;
        height: 100%;
    }
    
    .report-card:hover {
        transform: translateY(-5px);
    }
    
    .card-header-primary {
        background: linear-gradient(45deg, #4285f4, #5b9aff);
        color: white;
        padding: 15px;
    }
    
    .card-header-success {
        background: linear-gradient(45deg, #0f9d58, #54c986);
        color: white;
        padding: 15px;
    }
    
    .card-header-warning {
        background: linear-gradient(45deg, #f4b400, #f9ca64);
        color: white;
        padding: 15px;
    }
    
    .card-header-info {
        background: linear-gradient(45deg, #16aee0, #72cbf3);
        color: white;
        padding: 15px;
    }
    
    .report-description {
        min-height: 50px;
    }
    
    .filter-section {
        display: none;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        margin-bottom: 20px;
    }
    
    .filter-section.active {
        display: block;
    }
    
    .preview-table {
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
    }
    
    .info-box {
        background-color: #e8f4fd;
        border-left: 4px solid #4285f4;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center">
            <h2><i class="fas fa-file-pdf text-primary me-2"></i>Reports</h2>
            <div>
                <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                </a>
                <a href="{% url 'data_analysis' %}" class="btn btn-outline-primary">
                    <i class="fas fa-chart-line me-1"></i> Data Analysis
                </a>
            </div>
        </div>
        <p class="text-muted">Generate and download system reports</p>
    </div>
</div>

<!-- Information Box -->
<div class="info-box mb-4">
    <h5><i class="fas fa-info-circle me-2"></i>Reports Generation</h5>
    <p class="mb-0">Select a report type below, apply filters as needed, preview the data, and download as PDF. Reports contain real-time data from the system.</p>
</div>

<!-- Report Types -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-primary">
                <h5 class="card-title mb-0"><i class="fas fa-users me-2"></i>All System Users</h5>
            </div>
            <div class="card-body">
                <p class="report-description">List of all users in the system with role information.</p>
                <button type="button" class="btn btn-primary w-100 report-btn" data-report-type="all-users">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-success">
                <h5 class="card-title mb-0"><i class="fas fa-user me-2"></i>Regular Users</h5>
            </div>
            <div class="card-body">
                <p class="report-description">List of all users with 'user' role in the system.</p>
                <button type="button" class="btn btn-success w-100 report-btn" data-report-type="regular-users">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-warning">
                <h5 class="card-title mb-0"><i class="fas fa-user-shield me-2"></i>Admin Users</h5>
            </div>
            <div class="card-body">
                <p class="report-description">List of all users with 'admin' role in the system.</p>
                <button type="button" class="btn btn-warning w-100 report-btn" data-report-type="admin-users">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-info">
                <h5 class="card-title mb-0"><i class="fas fa-file-signature me-2"></i>Submitted Forms</h5>
            </div>
            <div class="card-body">
                <p class="report-description">List of all submitted forms with user information.</p>
                <button type="button" class="btn btn-info w-100 report-btn" data-report-type="submitted-forms">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-primary" style="background: linear-gradient(45deg, #673ab7, #9575cd);">
                <h5 class="card-title mb-0"><i class="fas fa-building me-2"></i>Wing-wise Forms</h5>
            </div>
            <div class="card-body">
                <p class="report-description">Submitted forms grouped by user wing.</p>
                <button type="button" class="btn btn-primary w-100 report-btn" data-report-type="wing-forms" style="background-color: #673ab7; border-color: #673ab7;">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-success" style="background: linear-gradient(45deg, #e91e63, #f48fb1);">
                <h5 class="card-title mb-0"><i class="fas fa-clipboard-check me-2"></i>Form Submissions</h5>
            </div>
            <div class="card-body">
                <p class="report-description">Detailed status of form submissions by users.</p>
                <button type="button" class="btn btn-success w-100 report-btn" data-report-type="form-submissions" style="background-color: #e91e63; border-color: #e91e63;">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-warning" style="background: linear-gradient(45deg, #009688, #4db6ac);">
                <h5 class="card-title mb-0"><i class="fas fa-sitemap me-2"></i>Department-wise</h5>
            </div>
            <div class="card-body">
                <p class="report-description">Responses grouped by department.</p>
                <button type="button" class="btn btn-warning w-100 report-btn" data-report-type="department-forms" style="background-color: #009688; border-color: #009688;">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="report-card">
            <div class="card-header-info" style="background: linear-gradient(45deg, #ff5722, #ff8a65);">
                <h5 class="card-title mb-0"><i class="fas fa-tasks me-2"></i>Process Reports</h5>
            </div>
            <div class="card-body">
                <p class="report-description">Forms grouped by process name.</p>
                <button type="button" class="btn btn-info w-100 report-btn" data-report-type="process-forms" style="background-color: #ff5722; border-color: #ff5722;">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Filter Sections -->
<div id="all-users-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>All Users Report</h5>
        </div>
        <div class="card-body">
            <form id="all-users-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="all-users">
                <div class="row g-3 align-items-center mb-3">
                    <div class="col-md-4">
                        <label for="user-search" class="form-label">Search by Name/Username:</label>
                        <input type="text" class="form-control" id="user-search" name="search">
                    </div>
                    <div class="col-md-4">
                        <label for="user-wing" class="form-label">Filter by Wing:</label>
                        <select class="form-select" id="user-wing" name="wing">
                            <option value="">All Wings</option>
                            {% for wing in wings %}
                                <option value="{{ wing.wing_name }}">{{ wing.wing_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="user-department" class="form-label">Filter by Department:</label>
                        <select class="form-select" id="user-department" name="department">
                            <option value="">All Departments</option>
                            {% for dept in departments %}
                                <option value="{{ dept.department_name }}">{{ dept.department_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="all-users">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="all-users-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Username</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Designation</th>
                                <th>Wing</th>
                                <th>Department</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="regular-users-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Regular Users Report</h5>
        </div>
        <div class="card-body">
            <form id="regular-users-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="regular-users">
                <div class="row g-3 align-items-center mb-3">
                    <div class="col-md-4">
                        <label for="regular-search" class="form-label">Search by Name/Username:</label>
                        <input type="text" class="form-control" id="regular-search" name="search">
                    </div>
                    <div class="col-md-4">
                        <label for="regular-wing" class="form-label">Filter by Wing:</label>
                        <select class="form-select" id="regular-wing" name="wing">
                            <option value="">All Wings</option>
                            {% for wing in wings %}
                                <option value="{{ wing.wing_name }}">{{ wing.wing_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="regular-department" class="form-label">Filter by Department:</label>
                        <select class="form-select" id="regular-department" name="department">
                            <option value="">All Departments</option>
                            {% for dept in departments %}
                                <option value="{{ dept.department_name }}">{{ dept.department_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="regular-users">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="regular-users-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Username</th>
                                <th>Name</th>
                                <th>Designation</th>
                                <th>Wing</th>
                                <th>Department</th>
                                <th>Mobile</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="admin-users-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Admin Users Report</h5>
        </div>
        <div class="card-body">
            <form id="admin-users-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="admin-users">
                <div class="row g-3 align-items-center mb-3">
                    <div class="col-md-6">
                        <label for="admin-search" class="form-label">Search by Name/Username:</label>
                        <input type="text" class="form-control" id="admin-search" name="search">
                    </div>
                    <div class="col-md-6">
                        <label for="admin-wing" class="form-label">Filter by Wing:</label>
                        <select class="form-select" id="admin-wing" name="wing">
                            <option value="">All Wings</option>
                            {% for wing in wings %}
                                <option value="{{ wing.wing_name }}">{{ wing.wing_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="admin-users">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="admin-users-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Username</th>
                                <th>Name</th>
                                <th>Designation</th>
                                <th>Wing</th>
                                <th>Department</th>
                                <th>Mobile</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="submitted-forms-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Submitted Forms Report</h5>
        </div>
        <div class="card-body">
            <form id="submitted-forms-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="submitted-forms">
                <div class="row g-3 align-items-center mb-3">
                    <div class="col-md-4">
                        <label for="forms-user" class="form-label">Filter by User:</label>
                        <select class="form-select" id="forms-user" name="user">
                            <option value="">All Users</option>
                            {% for user in users %}
                                <option value="{{ user.id }}">{{ user.username }} - {{ user.get_full_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="forms-process" class="form-label">Filter by Process Name:</label>
                        <input type="text" class="form-control" id="forms-process" name="process">
                    </div>
                    <div class="col-md-4">
                        <label for="forms-date-range" class="form-label">Date Range:</label>
                        <div class="input-group">
                            <input type="date" class="form-control" id="forms-date-from" name="date_from">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" id="forms-date-to" name="date_to">
                        </div>
                    </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="submitted-forms">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="submitted-forms-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>User ID</th>
                                <th>User Name</th>
                                <th>Process Name</th>
                                <th>Submitted At</th>
                                <th>Wing</th>
                                <th>Department</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="wing-forms-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Wing-wise Forms Report</h5>
        </div>
        <div class="card-body">
            <form id="wing-forms-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="wing-forms">
                <div class="row g-3 align-items-center mb-3">
                    <div class="col-md-4">
                        <label for="wing-select" class="form-label">Select Wing:</label>
                        <select class="form-select" id="wing-select" name="wing" required>
                            <option value="">Select a Wing</option>
                            {% for wing in wings %}
                                <option value="{{ wing.wing_name }}">{{ wing.wing_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="wing-process" class="form-label">Filter by Process Name:</label>
                        <input type="text" class="form-control" id="wing-process" name="process">
                    </div>
                    <div class="col-md-4">
                        <label for="wing-date-range" class="form-label">Date Range:</label>
                        <div class="input-group">
                            <input type="date" class="form-control" id="wing-date-from" name="date_from">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" id="wing-date-to" name="date_to">
                        </div>
                    </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="wing-forms">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="wing-forms-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Wing</th>
                                <th>User ID</th>
                                <th>User Name</th>
                                <th>Process Name</th>
                                <th>Submitted At</th>
                                <th>Department</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="form-submissions-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Form Submissions Report</h5>
        </div>
        <div class="card-body">
            <form id="form-submissions-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="form-submissions">
                
                <div class="mb-3">
                    <label class="form-label">Select Users:</label>
                    <div class="mb-3">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="user_selection" id="all-users-radio" value="all" checked>
                            <label class="form-check-label" for="all-users-radio">All Users</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="user_selection" id="specific-user-radio" value="specific">
                            <label class="form-check-label" for="specific-user-radio">Specific User</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="user_selection" id="multiple-users-radio" value="multiple">
                            <label class="form-check-label" for="multiple-users-radio">Multiple Users</label>
                        </div>
                    </div>
                    
                    <div id="specific-user-container" style="display: none;">
                        <select class="form-select" id="specific-user-select" name="specific_user">
                            <option value="">Select a User</option>
                            {% for user in users %}
                                <option value="{{ user.id }}">{{ user.username }} - {{ user.get_full_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div id="multiple-users-container" style="display: none;">
                        <div class="row">
                            <div class="col-md-9">
                                <select class="form-select" id="multiple-users-select" size="5" multiple>
                                    {% for user in users %}
                                        <option value="{{ user.id }}">{{ user.username }} - {{ user.get_full_name }}</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple users</small>
                            </div>
                            <div class="col-md-3">
                                <button type="button" id="add-selected-users" class="btn btn-sm btn-primary w-100 mb-2">
                                    <i class="fas fa-chevron-right"></i> Add
                                </button>
                                <button type="button" id="remove-selected-users" class="btn btn-sm btn-danger w-100">
                                    <i class="fas fa-chevron-left"></i> Remove
                                </button>
                            </div>
                        </div>
                        <div class="mt-2">
                            <label class="form-label">Selected Users:</label>
                            <select class="form-select" id="selected-users-list" name="multiple_users" size="3" multiple>
                                <!-- Selected users will be added here -->
                            </select>
                            <input type="hidden" id="selected-users-hidden" name="selected_users">
                        </div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="submissions-date-range" class="form-label">Date Range:</label>
                        <div class="input-group">
                            <input type="date" class="form-control" id="submissions-date-from" name="date_from">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" id="submissions-date-to" name="date_to">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="submissions-process" class="form-label">Filter by Process Name:</label>
                        <input type="text" class="form-control" id="submissions-process" name="process">
                    </div>
                </div>
                
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="form-submissions">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="form-submissions-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>User ID</th>
                                <th>User Name</th>
                                <th>Process Name</th>
                                <th>Submitted At</th>
                                <th>Wing</th>
                                <th>Department</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="department-forms-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Department-wise Forms Report</h5>
        </div>
        <div class="card-body">
            <form id="department-forms-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="department-forms">
                <div class="row g-3 align-items-center mb-3">
                    <div class="col-md-4">
                        <label for="department-select" class="form-label">Select Department:</label>
                        <select class="form-select" id="department-select"
                        <!--- Continuing from the provided HTML code --->
                        <select class="form-select" id="department-select" name="department" required>
                            <option value="">Select a Department</option>
                            {% for dept in departments %}
                                <option value="{{ dept.department_name }}">{{ dept.department_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="dept-process" class="form-label">Filter by Process Name:</label>
                        <input type="text" class="form-control" id="dept-process" name="process">
                    </div>
                    <div class="col-md-4">
                        <label for="dept-date-range" class="form-label">Date Range:</label>
                        <div class="input-group">
                            <input type="date" class="form-control" id="dept-date-from" name="date_from">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" id="dept-date-to" name="date_to">
                        </div>
                    </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="department-forms">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="department-forms-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Department</th>
                                <th>User ID</th>
                                <th>User Name</th>
                                <th>Process Name</th>
                                <th>Submitted At</th>
                                <th>Wing</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="process-forms-filters" class="filter-section">
    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Process-wise Forms Report</h5>
        </div>
        <div class="card-body">
            <form id="process-forms-form" method="get" action="{% url 'generate_report' %}">
                <input type="hidden" name="report_type" value="process-forms">
                <div class="row g-3 align-items-center mb-3">
                    <div class="col-md-4">
                        <label for="process-select" class="form-label">Process Name:</label>
                        <select class="form-select" id="process-select" name="process" required>
                            <option value="">Select a Process</option>
                            {% for process in processes %}
                                <option value="{{ process.process_name }}">{{ process.process_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="process-wing" class="form-label">Filter by Wing:</label>
                        <select class="form-select" id="process-wing" name="wing">
                            <option value="">All Wings</option>
                            {% for wing in wings %}
                                <option value="{{ wing.wing_name }}">{{ wing.wing_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="process-date-range" class="form-label">Date Range:</label>
                        <div class="input-group">
                            <input type="date" class="form-control" id="process-date-from" name="date_from">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" id="process-date-to" name="date_to">
                        </div>
                    </div>
                </div>
                <div class="mt-3 d-flex justify-content-between">
                    <button type="button" class="btn btn-primary filter-btn" data-report-type="process-forms">
                        <i class="fas fa-search me-1"></i> Apply Filters
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </form>
            
            <div class="preview-table" id="process-forms-preview">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Process Name</th>
                                <th>User ID</th>
                                <th>User Name</th>
                                <th>Submitted At</th>
                                <th>Wing</th>
                                <th>Department</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preview data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Show filter section when a report button is clicked
        const reportBtns = document.querySelectorAll('.report-btn');
        reportBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Hide all filter sections
                document.querySelectorAll('.filter-section').forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });
                
                // Show the selected filter section
                const reportType = this.getAttribute('data-report-type');
                const filterSection = document.getElementById(reportType + '-filters');
                if (filterSection) {
                    filterSection.classList.add('active');
                    filterSection.style.display = 'block';
                    
                    // Automatically load preview data
                    loadPreviewData(reportType, {});
                }
            });
        });
        
        // Handle filter buttons
        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const reportType = this.getAttribute('data-report-type');
                const formId = reportType + '-form';
                const formData = new FormData(document.getElementById(formId));
                
                // Convert FormData to object
                const params = {};
                for (const [key, value] of formData.entries()) {
                    params[key] = value;
                }
                
                // Load preview data with filters
                loadPreviewData(reportType, params);
            });
        });
        
        // Form submissions user selection radio buttons
        const userSelectionRadios = document.querySelectorAll('input[name="user_selection"]');
        const specificUserContainer = document.getElementById('specific-user-container');
        const multipleUsersContainer = document.getElementById('multiple-users-container');
        
        userSelectionRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'specific') {
                    specificUserContainer.style.display = 'block';
                    multipleUsersContainer.style.display = 'none';
                } else if (this.value === 'multiple') {
                    specificUserContainer.style.display = 'none';
                    multipleUsersContainer.style.display = 'block';
                } else {
                    specificUserContainer.style.display = 'none';
                    multipleUsersContainer.style.display = 'none';
                }
            });
        });
        
        // Multiple users selection
        const addSelectedUsersBtn = document.getElementById('add-selected-users');
        const removeSelectedUsersBtn = document.getElementById('remove-selected-users');
        const multipleUsersSelect = document.getElementById('multiple-users-select');
        const selectedUsersList = document.getElementById('selected-users-list');
        const selectedUsersHidden = document.getElementById('selected-users-hidden');
        
        if(addSelectedUsersBtn) {
            addSelectedUsersBtn.addEventListener('click', function() {
                const selectedOptions = Array.from(multipleUsersSelect.selectedOptions);
                
                selectedOptions.forEach(option => {
                    // Check if already in selected list
                    if (Array.from(selectedUsersList.options).every(existingOption => existingOption.value !== option.value)) {
                        const newOption = document.createElement('option');
                        newOption.value = option.value;
                        newOption.textContent = option.textContent;
                        selectedUsersList.appendChild(newOption);
                    }
                });
                
                updateSelectedUsersHidden();
            });
        }
        
        if(removeSelectedUsersBtn) {
            removeSelectedUsersBtn.addEventListener('click', function() {
                const selectedOptions = Array.from(selectedUsersList.selectedOptions);
                
                selectedOptions.forEach(option => {
                    selectedUsersList.removeChild(option);
                });
                
                updateSelectedUsersHidden();
            });
        }
        
        function updateSelectedUsersHidden() {
            if(selectedUsersList) {
                const selectedValues = Array.from(selectedUsersList.options).map(option => option.value);
                selectedUsersHidden.value = selectedValues.join(',');
            }
        }
        
        // Function to load preview data
        function loadPreviewData(reportType, params) {
            const previewElement = document.getElementById(reportType + '-preview');
            const previewTable = previewElement.querySelector('tbody');
            
            // Show loading state
            previewTable.innerHTML = '<tr><td colspan="6" class="text-center py-3"><i class="fas fa-spinner fa-spin me-2"></i> Loading preview data...</td></tr>';
            
            // Add report_type to params
            params.report_type = reportType;
            params.preview = 'true';
            
            // Build query string
            const queryString = new URLSearchParams(params).toString();
            
            // Fetch preview data
            fetch(`{% url 'preview_report' %}?${queryString}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        previewTable.innerHTML = `<tr><td colspan="6" class="text-center py-3 text-danger"><i class="fas fa-exclamation-circle me-2"></i> ${data.error}</td></tr>`;
                        return;
                    }
                    
                    if (data.rows && data.rows.length > 0) {
                        previewTable.innerHTML = '';
                        data.rows.forEach(row => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = row;
                            previewTable.appendChild(tr);
                        });
                    } else {
                        previewTable.innerHTML = '<tr><td colspan="6" class="text-center py-3">No data found matching the criteria.</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching preview data:', error);
                    previewTable.innerHTML = '<tr><td colspan="6" class="text-center py-3 text-danger"><i class="fas fa-exclamation-circle me-2"></i> Error loading preview data. Please try again.</td></tr>';
                });
        }
    });
</script>
{% endblock %}